(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}})();console.log("load validators");function L(e){if(typeof e!="string")throw new Error("email is not an string");if(!e.trim().length)throw new Error("email is empty")}function N(e,t="password"){if(typeof e!="string")throw new Error(`${t} is not a string`);if(!e.length)throw new Error(`${t} is empty`)}function $(e,t="password"){if(typeof e!="string")throw new Error(`${t} is not a string`);if(!e.length)throw new Error(`${t} is empty`);if(!/[^\w\s]/.test(e))throw new Error(`${t} need a special character`);if(!/\d/.test(e))throw new Error(`${t} need a number`);if(e.trim().length<8)throw new Error(`${t} is too short`)}function I(e){if(!e.length&&!email.length&&!password.length)throw new Error("All fields are empty");if(!e.trim().length)throw new Error("Name is empty");if(e.includes(" "))throw new Error("Name is not valid");if(e.trim().length<2)throw new Error("Name is too short");if(typeof e!="string")throw new Error(e+" is not a string")}function x(e,t="url"){if(typeof e!="string")throw new Error(`${t} is not a string`);if(!e.trim().length)throw new Error(`${t} is empty`)}function u(e,t="id"){if(typeof e!="string")throw new Error(`${t} is not a string`);if(!e.trim().length)throw new Error(`${t} is empty`)}function O(e,t="text"){if(typeof e!="string")throw new Error(`${t} is not a string`);if(!e.trim().length)throw new Error(`${t} is empty`)}console.log("load data");const v=()=>"usersJson"in localStorage?JSON.parse(localStorage.usersJson):[],S=()=>{const e="postsJson"in localStorage?JSON.parse(localStorage.postsJson):[];return e.forEach(t=>t.date=new Date(t.date)),e};function J(e){localStorage.usersJson=JSON.stringify(e)}function T(e){const t=v(),r=t.findIndex(n=>n.id===e.id);r<0?t.push(e):t.splice(r,1,e),J(t)}function b(e){localStorage.postsJson=JSON.stringify(e)}function _(e){const t=S(),r=t.findIndex(n=>n.id===e.id);r<0?t.push(e):t.splice(r,1,e),b(t)}function A(e){return v().find(t=>t.email===e)}function g(e){return v().find(t=>t.id===e)}function F(e){return S().find(t=>t.id===e)}function M(e,t){L(e),N(t);const r=A(e);if(!r)throw new Error("user not found");if(r.password!==t)throw new Error("wrong password");return r.id}console.log("load ui");function c(...e){for(var t=0;t<e.length;t++)e[t].classList.remove("off")}function d(...e){for(var t=0;t<e.length;t++)e[t].classList.add("off")}const a=sessionStorage;function H(e,t,r){if(I(e),L(t),$(r),A(t))throw new Error("user already exists");const o=v(),s=o[o.length-1];let i="user-1";s&&(i="user-"+(parseInt(s.id.slice(5))+1));const f={id:i,name:e,email:t,password:r};o.push(f),J(o)}console.log("load register-page");const E=document.querySelector(".register"),K=E.querySelector("form");K.onsubmit=function(e){e.preventDefault();const t=e.target.name.value,r=e.target.email.value,n=e.target.password.value;try{H(t,r,n),d(E),c(h)}catch(o){alert(o.message)}};E.querySelector("a").onclick=function(e){e.preventDefault(),d(E),c(h)};function V(e,t){u(e,"user Id"),x(t,"avatar Url");const r=g(e);if(!r)throw new Error("user not found");r.avatar=t,T(r)}function j(e,t,r,n){u(e),N(t),$(r,"new password"),$(n,"new password confirm");const o=g(e);if(!o)throw new Error("user not found");if(t!==o.password)throw new Error("wrong actual password");if(r!==n)throw new Error("password confirmation mismatch");if(r===t)throw new Error("new password equals old password");o.password=r,T(o)}function z(e,t){const r=e.querySelector(".profile"),n=r.querySelector(".profile-avatar-form"),o=r.querySelector(".profile-password-form");return n.onsubmit=function(s){s.preventDefault();const i=s.target.url.value;try{V(a.userId,i),alert("avatar updated"),t.src=i,n.reset()}catch(f){alert(f.message)}},o.onsubmit=function(s){s.preventDefault();const i=s.target.password.value,f=s.target.newPassword.value,w=s.target.newPasswordConfirm.value;try{j(a.userId,i,f,w),alert("password updated"),o.reset()}catch(y){alert(y.message)}},r}function G(e){if(u(e,"use id"),!v().some(r=>r.id===e))throw new Error(`user with id ${e} not found`);return S().toReversed()}function Q(e){u(e,"user Id");let t=g(e);if(!t)throw new Error("user not found");return t={name:t.name,avatar:t.avatar},t.avatar&&(t.avatar=t.avatar),t}function W(e,t,r,n){if(u(e,"user id"),u(t,"post id"),x(r,"image url"),O(n,"text"),!g(e))throw new Error(`user with id ${e} does not exist`);const s=F(t);if(!s)throw new Error(`post with id ${t} does not exist`);if(s.author!==e)throw new Error(`user with id ${e} is not the author of post with id ${t}`);s.image=r,s.text=n,s.date=new Date,_(s)}function X(e,t,r){if(u(e,"userId"),x(t,"image"),O(r),!g(e))throw new Error(`user with id ${e} does not exist`);let o="post-1";const s=S(),i=s[s.length-1];i&&(o="post-"+(parseInt(i.id.slice(5))+1));const f={id:o,author:e,image:t,text:r,date:new Date};s.push(f),b(s)}function Y(e){const t=e.querySelector(".add-post"),r=t.querySelector("form");return r.querySelector(".button-cancel").onclick=n=>{n.preventDefault(),r.reset(),d(t)},t.querySelector("form").onsubmit=n=>{n.preventDefault();const o=n.target.image.value,s=n.target.text.value;try{X(a.userId,o,s),alert("post created"),d(t),p()}catch(i){alert(i.message)}},t}function Z(e,t){if(u(e,"user id"),u(t,"post id"),!g(e))throw new Error(`user with id ${e} not found`);const n=F(t);if(!n)throw new Error(`post with id ${t} not found`);if(!n.likes)n.likes=[e];else{const o=n.likes.indexOf(e);o<0?n.likes.push(e):(n.likes.splice(o,1),n.likes.length||delete n.likes)}_(n)}function ee(e,t){if(u(e,"userId"),u(t,"postId"),!g(e))throw new Error(`user with id ${e} does not exist`);const n=S(),o=n.findIndex(s=>s.id===t);if(o<0)throw new Error(`post with id ${t} does not exist`);if(n[o].author!==e)throw new Error(`user with id ${e} is not the author of post with id ${t}`);n.splice(o,1),b(n)}console.log("load home-page");const B="https://www.17thshard.com/forum/uploads/monthly_2016_11/cosmere_symbol.png.6e4715593bec01929a850170904f5a4d.png",l=document.querySelector(".home"),k=l.querySelector(".home-header-avatar"),R=l.querySelector("a"),te=l.querySelector(".add-post-button"),U=z(l,k),re=Y(l),q=l.querySelector(".edit-post"),m=q.querySelector("form"),P=l.querySelector(".post-list");R.onclick=function(e){e.preventDefault(),c(U),d(P)};l.querySelector(".button-home").onclick=function(){c(P),d(U)};l.querySelector(".btn-container-header-logout").onclick=function(){delete a.userId,k.src=B,d(l,U),c(h)};te.onclick=()=>c(re);m.onsubmit=e=>{e.preventDefault();const t=e.target.postId.value,r=e.target.image.value,n=e.target.text.value;try{W(a.userId,t,r,n),alert("post Updated"),d(q),p()}catch(o){alert(o.message)}};m.querySelector(".button-cancel").onclick=e=>{e.preventDefault(),m.reset(),d(q)};function p(){try{const e=G(a.userId);return P.innerHTML="",e.forEach(t=>{const r=document.createElement("article"),n=document.createElement("img");n.src=t.image;const o=document.createElement("p");o.innerText=t.text;const s=document.createElement("time");if(s.innerText=t.date.toLocaleString(),t.author===a.userId){const w=document.createElement("button");w.innerText="Edit";const y=document.createElement("button");y.innerText="Delete",w.onclick=()=>{m.querySelector("input[type=hidden]").value=t.id,m.querySelector("input[type=url]").value=t.image,m.querySelector("textarea").value=t.text,c(q)},y.onclick=()=>{try{ee(a.userId,t.id),alert("post deleted"),p()}catch{alert(error.message)}},r.append(n,o,s,w,y)}else r.append(n,o,s);const i=document.createElement("button"),f=t.likes&&t.likes.length||0;i.innerText=t.likes&&t.likes.includes(a.userId)?`â¤ï¸ (${f})`:`ðŸ¤ (${f})`,i.onclick=()=>{try{Z(a.userId,t.id),p()}catch(w){alert(w.message)}},r.appendChild(i),P.appendChild(r)}),!0}catch(e){return alert(e.message),!1}}function C(){try{const e=Q(a.userId);return R.innerText=e.name,k.src=e.avatar?e.avatar:B,!0}catch(e){return alert(e.message),!1}}console.log("load login-page");const h=document.querySelector(".login"),D=h.querySelector("form");D.onsubmit=function(e){e.preventDefault();const t=e.target.email.value,r=e.target.password.value;try{a.userId=M(t,r),C(),p(),D.reset(),d(h),c(l)}catch(n){alert(n.message)}};h.querySelector("a").onclick=function(e){e.preventDefault(),d(h),c(E)};console.log("load main");a.userId===void 0?c(h):C()?p()&&c(l):c(h);
